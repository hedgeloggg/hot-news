# .github/workflows/hot-news.yml
name: Global Social Hot News Digest

on:
  schedule:
    - cron: '0 3 * * *'  # UTC 1:00 = 北京时间 9:00
  workflow_dispatch:     # 允许手动触发

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install \
            feedparser \          # 解析 RSS
            beautifulsoup4 \      # 解析 HTML（用于百度热搜等）
            lxml \                # RSS 解析加速
            dashscope \           # 调用 Qwen3-Max
            requests              # HTTP 请求

      - name: Run hot news fetcher
        run: python digest.py   # ← 替换为你的主脚本名（如 main.py）
        env:
          DASHSCOPE_API_KEY: ${{ secrets.DASHSCOPE_API_KEY }}

      - name: AI analyze with Qwen3-Max
        run: python scripts/ai_summarize.py

      - name: Send email report
        run: python scripts/send_email.py
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
          TO_EMAIL: ${{ secrets.TO_EMAIL }}
